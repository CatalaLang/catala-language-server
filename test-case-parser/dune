(rule
 (targets test_case_j.ml test_case_j.mli)
 (deps test_case.atd)
 (action
  (run atdgen -j -j-std %{deps})))

(rule
 (targets test_case_t.ml test_case_t.mli)
 (deps test_case.atd)
 (action
  (run atdgen -t %{deps})))

(library
 (name test_case_parser_lib_atd)
 (modules test_case_t test_case_j test_case_parser_lib_atd)
 (libraries catala.driver catala.clerk_config atdgen-runtime))

(executable
 (name testcase)
 (modes plugin)
 (modules testcase)
 (libraries yojson atdgen-runtime test_case_parser_lib_atd)
 (embed_in_plugin_libraries
  otoml
  catala.clerk_config
  yojson
  atdgen-runtime
  test_case_parser_lib_atd))

(install
 (files
  (testcase.cmxs as catala/plugins/testcase.cmxs))
 (section libexec_root))
