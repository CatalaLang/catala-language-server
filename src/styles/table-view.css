/* Table Array Editor Styles */

.table-array-editor {
  display: flex;
  flex-direction: column;
  gap: var(--spacing16);
  margin-bottom: var(--spacing8);
  min-width: 0; /* Allow flex shrinking so table-wrapper can scroll */
}

/* View toggle button (table <-> tree) */
.table-view-toggle {
  display: flex;
  justify-content: flex-end;
  margin-bottom: calc(-1 * var(--spacing8));
}

.table-view-toggle .table-control-btn {
  opacity: 0.6;
}

.table-view-toggle .table-control-btn:hover {
  opacity: 1;
}

/* Table wrapper for horizontal scrolling */
.table-wrapper {
  overflow-x: auto;
  width: 100%;
  min-width: 0; /* Allow flex shrinking below content size */
  border: 1px solid var(--card-border-light);
  border-radius: 4px;
}

/* Empty state */
.empty-table-message {
  padding: var(--spacing32);
  text-align: center;
  color: var(--field-label-color);
  font-size: 14px;
  font-style: italic;
  background-color: var(--level-2-background);
  border-radius: 4px;
}

/* Main table */
.table-view {
  border-collapse: collapse;
  background-color: var(--card-background);
  width: 100%;
}

/* Table header */
.table-view thead {
  background-color: var(--card-background-alt);
  position: sticky;
  top: 0;
  z-index: 10;
}

.table-view th {
  padding: var(--spacing8);
  text-align: left;
  font-weight: var(--field-label-font-weight);
  font-size: var(--field-label-font-size);
  color: var(--field-label-color);
  text-transform: capitalize;
  border-bottom: 1px solid var(--card-border);
  white-space: nowrap;
  vertical-align: middle;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 120px; /* Ensure content columns don't get compressed */
}

/* Regular content headers */
.table-header {
  min-width: 150px; /* Give content columns breathing room */
}

.table-header-sub-array {
  width: 40px;
  min-width: 40px;
  max-width: 120px;
  text-align: center !important;
  white-space: normal !important;
  word-wrap: break-word;
  overflow-wrap: break-word;
  hyphens: auto;
  line-height: 1.2;
  max-height: 2.4em; /* Approximately 2 lines */
  overflow: hidden;
  text-overflow: ellipsis;
  vertical-align: middle;
  padding: var(--spacing4) var(--spacing4) !important;
  font-size: 11px;
}

/* Combined header for row number + controls */
.table-header-controls-combined {
  width: 240px; /* Combined width: 60px number + 180px label/controls */
  min-width: 240px;
  max-width: 240px;
  text-align: center;
  position: sticky;
  left: 0;
  z-index: 12;
  background-color: var(--card-background-alt);
  border-right: 2px solid var(--card-border);
  box-shadow: 2px 0 4px rgba(0, 0, 0, 0.08);
  padding: var(--spacing8);
}

/* Widen header in sub-tables to match wider controls cell */
.sub-table-content .table-header-controls-combined {
  width: 320px; /* +80px for parent label */
  min-width: 320px;
  max-width: 320px;
}

/* Narrower header when not editable (detected by checking if tbody has narrow cells) */
.table-view:has(.table-cell-controls:has(.table-row-controls > span:only-child))
  .table-header-controls-combined {
  width: 60px;
  min-width: 60px;
  max-width: 60px;
}

/* Table body */
.table-view tbody tr {
  border-bottom: 1px solid var(--card-border-light);
  transition: background-color 0.15s ease-in-out;
  background-color: var(--card-background);
}

.table-view tbody tr:last-child {
  border-bottom: none;
}

.table-view tbody tr:hover {
  background-color: var(--tab-hover-background);
}

.table-view tbody tr.dragging {
  opacity: 0.5;
}

.table-view td {
  padding: var(--spacing8);
  vertical-align: middle;
  border-bottom: 1px solid var(--card-border-light);
}

/* Sticky cells must remain opaque (not inherit translucent hover) */
.table-view tbody tr:hover .table-cell-controls {
  background-color: var(--card-background);
}

/* Table cells */
.table-cell {
  position: relative;
  overflow: visible;
}

.table-cell > * {
  max-width: 100%;
}

/* Override ValueEditor max-width in table context */
.table-view .value-editor {
  max-width: none !important;
  display: block !important;
}

/* Let inputs/selects size naturally based on content */
.table-view .value-editor input,
.table-view .value-editor select {
  width: 100% !important;
  box-sizing: border-box !important;
}

/* Sub-array count cell */
.table-cell-sub-array-count {
  text-align: center;
  padding: var(--spacing4) !important;
  width: 70px;
  min-width: 70px;
  max-width: 70px;
}

.sub-array-cell-content {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--spacing4);
}

.count-badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  min-width: 24px;
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 11px;
  font-weight: 600;
  background-color: var(--vscode-badge-background);
  color: var(--vscode-badge-foreground);
  border: none;
}

.count-badge-clickable {
  cursor: pointer;
  transition: background-color 0.2s ease-in-out;
}

.count-badge-clickable:hover {
  background-color: var(--vscode-button-hoverBackground);
}

.count-badge-zero {
  opacity: 0.5;
  cursor: default;
  min-width: 24px;
  max-width: 24px;
  box-sizing: border-box;
}

/* Add sub-array pill */
.add-subarray-pill {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  background-color: var(--vscode-button-background);
  color: var(--vscode-button-foreground);
  border: none;
  cursor: pointer;
  transition: background-color 0.2s ease-in-out;
  position: relative;
}

.add-subarray-pill:hover {
  background-color: var(--vscode-button-hoverBackground);
}

/* Context menu (rendered via portal) */
.context-menu {
  position: fixed;
  background-color: var(--vscode-dropdown-background);
  border: 1px solid var(--vscode-dropdown-border);
  border-radius: 4px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
  z-index: 10000;
  min-width: 200px;
  max-height: 300px;
  overflow-y: auto;
}

.context-menu-item {
  padding: var(--spacing8) var(--spacing12);
  cursor: pointer;
  font-size: 13px;
  color: var(--vscode-dropdown-foreground);
  transition: background-color 0.15s ease-in-out;
  white-space: nowrap;
}

.context-menu-item:hover {
  background-color: var(--vscode-list-hoverBackground);
}

.context-menu-item:active {
  background-color: var(--vscode-list-activeSelectionBackground);
  color: var(--vscode-list-activeSelectionForeground);
}

/* Row controls cell - always present, includes row number */
.table-cell-controls {
  padding: var(--spacing8);
  width: 240px; /* Combined width: 60px number + 180px label/controls */
  min-width: 240px;
  max-width: 240px;
  position: sticky;
  left: 0;
  z-index: 10; /* Higher z-index so dropdown appears above other content */
  background-color: var(--card-background);
  border-right: 2px solid var(--card-border);
  box-shadow: 2px 0 4px rgba(0, 0, 0, 0.08);
}

/* Widen controls cell in sub-tables to accommodate parent label */
.sub-table-content .table-cell-controls {
  width: 320px; /* +80px for parent label: 60px number + 260px label/parent/controls */
  min-width: 320px;
  max-width: 320px;
}

/* Thin border on left edge for sub-table rows only */
.sub-table-row .table-cell-controls::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: -1px; /* Extend to cover the 1px row border gap */
  width: 2px;
  background-color: var(--vscode-panelTitle-activeBorder);
}

/* Shade cycling for adjacent parent groups */
.sub-table-row.parent-shade-odd .table-cell-controls::before {
  opacity: 0.6;
}

/* Visual separation between different parent groups */
.sub-table-row.parent-group-start {
  border-top: 4px solid transparent;
}

/* First sub-table row doesn't need top gap */
.sub-table-row.parent-group-start:first-child {
  border-top: none;
}

/* Break the border continuity at group boundaries */
.sub-table-row.parent-group-start .table-cell-controls::before {
  top: 0; /* Don't extend into the gap above */
}

/* Narrower controls cell when not editable (no buttons, just row number) */
.table-cell-controls:has(.table-row-controls > span:only-child) {
  width: 60px;
  min-width: 60px;
  max-width: 60px;
}

/* Editable row label input for top-level rows */
.row-label-input {
  background: transparent;
  border: none;
  border-bottom: 1px dashed transparent;
  color: var(--vscode-editor-foreground);
  font-size: 13px;
  font-weight: 500;
  padding: 2px 4px;
  min-width: 60px;
  max-width: 180px;
  margin-right: var(--spacing4);
  transition:
    border-color 0.15s ease-in-out,
    background-color 0.15s ease-in-out;
}

.row-label-input:hover:not(:disabled) {
  border-bottom-color: var(--vscode-input-border);
}

.row-label-input:focus {
  outline: none;
  border-bottom-color: var(--vscode-focusBorder);
  background-color: var(--vscode-input-background);
}

.row-label-input::placeholder {
  color: var(--vscode-input-placeholderForeground);
  font-style: italic;
  font-weight: 400;
}

.row-label-input:disabled {
  opacity: 0.6;
}

/* Parent navigation link for sub-table rows */
.parent-nav-link {
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: pointer;
  color: var(--vscode-textLink-foreground);
  font-size: 13px;
  padding: 2px 4px;
  margin-right: var(--spacing4);
  border-radius: 3px;
  transition: background-color 0.15s ease-in-out;
}

.parent-nav-link:hover {
  background-color: var(--vscode-list-hoverBackground);
}

.parent-nav-link .codicon-reply {
  font-size: 14px;
}

.parent-nav-label {
  font-weight: 500;
  max-width: 100px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.table-row-controls {
  display: flex;
  gap: 4px;
  justify-content: flex-end;
  align-items: center;
}

.table-control-btn {
  background: none;
  border: none;
  cursor: pointer;
  color: var(--vscode-editor-foreground);
  padding: 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.7;
  transition: opacity 0.2s ease-in-out;
  border-radius: 2px;
  min-width: 24px;
  height: 24px;
}

.table-control-btn:hover {
  opacity: 1;
  background-color: var(--tab-hover-background);
}

.table-control-btn:disabled {
  opacity: 0.3;
  cursor: not-allowed;
}

.table-control-delete:hover {
  background-color: var(
    --vscode-inputValidation-errorBackground,
    rgba(255, 86, 48, 0.22)
  );
}

/* Sub-table sections */
.sub-table-section {
  margin-top: var(--spacing16);
  border-radius: 4px;
  border: 1px solid var(--card-border-light);
}

.sub-table-header {
  display: flex;
  align-items: center;
  gap: var(--spacing8);
  padding: var(--spacing8);
  background-color: var(--card-background-alt);
  border-left: 4px solid var(--vscode-badge-background);
  font-weight: 600;
  font-size: 14px;
  color: var(--field-label-color);
  text-transform: capitalize;
}

.sub-table-content {
  padding: 0;
  background-color: var(--card-background);
}

/* Sub-tables within sub-table sections */
.sub-table {
  font-size: 12px;
  border: 1px solid var(--card-border);
}

.sub-table th,
.sub-table td {
  padding: 6px 8px;
  font-size: 12px;
}

/* Sub-table row with left border for parent indication */
.sub-table-row {
  transition: background-color 0.15s ease-in-out;
}

.sub-table-row:hover {
  background-color: var(--vscode-list-hoverBackground);
}

/* Flash animation for parent row when navigated to */
@keyframes flash-highlight {
  0%,
  100% {
    background-color: transparent;
  }
  50% {
    background-color: var(--vscode-editor-findMatchHighlightBackground);
  }
}

.flash-highlight {
  animation: flash-highlight 1s ease-in-out;
}

/* Sticky cells need their own animation since they have explicit background */
@keyframes flash-highlight-sticky {
  0%,
  100% {
    background-color: var(--card-background);
  }
  50% {
    background-color: var(--vscode-editor-findMatchHighlightBackground);
  }
}

.flash-highlight .table-cell-controls {
  animation: flash-highlight-sticky 1s ease-in-out;
}

/* Nested array editors in sub-tables */
.sub-table-content .array-editor {
  margin-bottom: 0;
}

/* Responsive behavior */
/* Removed problematic display: block override - table-wrapper handles scrolling */

@media screen and (max-width: 768px) {
  .table-view th,
  .table-view td {
    padding: var(--spacing8) var(--spacing8);
    font-size: 13px;
  }

  .table-control-btn {
    min-width: 20px;
    height: 20px;
    padding: 2px;
  }
}

/* Dark mode adjustments */
.vscode-dark .table-view tbody tr:hover {
  background-color: var(--level-2-background-dark);
}

.vscode-dark .empty-table-message {
  background-color: var(--level-2-background-dark);
}

.vscode-dark .sub-table-content {
  background-color: var(--level-2-background-dark);
}

/* Badge z-index within table cells */
.table-cell .unset-badge,
.table-cell .invalid-badge {
  z-index: 1;
}

/* Ensure badges don't overflow table cells */
.table-cell {
  overflow: visible;
}

/* Phantom rows (actual-only diffs) */
.phantom-row {
  background: repeating-linear-gradient(
    45deg,
    var(--vscode-inputValidation-warningBackground, rgba(255, 204, 0, 0.1)),
    var(--vscode-inputValidation-warningBackground, rgba(255, 204, 0, 0.1)) 10px,
    transparent 10px,
    transparent 20px
  ) !important;
  border-left: 3px solid var(--vscode-inputValidation-warningBorder, #ffcc00);
}

.phantom-row:hover {
  background: repeating-linear-gradient(
    45deg,
    var(--vscode-inputValidation-warningBackground, rgba(255, 204, 0, 0.15)),
    var(--vscode-inputValidation-warningBackground, rgba(255, 204, 0, 0.15))
      10px,
    var(--tab-hover-background, rgba(255, 255, 255, 0.1)) 10px,
    var(--tab-hover-background, rgba(255, 255, 255, 0.1)) 20px
  ) !important;
}

/* Remove colored border for phantom rows */
.phantom-row .table-cell-controls::before {
  display: none;
}

.phantom-row-indicator {
  display: flex;
  flex-direction: column;
  gap: var(--spacing4);
  margin-bottom: var(--spacing8);
  padding: var(--spacing4);
  background-color: var(
    --vscode-inputValidation-warningBackground,
    rgba(255, 204, 0, 0.1)
  );
  border-radius: 4px;
  border-left: 3px solid var(--vscode-inputValidation-warningBorder, #ffcc00);
}

.phantom-actual-label {
  font-size: 11px;
  font-weight: 600;
  color: var(--vscode-inputValidation-warningForeground, #ffcc00);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Action buttons for phantom/expected-only rows (larger with text) */
.phantom-action-btn {
  display: flex;
  align-items: center;
  gap: var(--spacing8);
  padding: var(--spacing4) var(--spacing12);
  border: none;
  border-radius: 4px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.15s ease-in-out;
  white-space: nowrap;
}

.phantom-action-btn.phantom-accept {
  background-color: var(--vscode-button-background);
  color: var(--vscode-button-foreground);
}

.phantom-action-btn.phantom-accept:hover {
  background-color: var(--vscode-button-hoverBackground);
}

.phantom-action-btn.phantom-remove {
  background-color: var(
    --vscode-inputValidation-errorBackground,
    rgba(255, 86, 48, 0.2)
  );
  color: var(--vscode-errorForeground, #ff5630);
  border: 1px solid var(--vscode-inputValidation-errorBorder, #ff5630);
}

.phantom-action-btn.phantom-remove:hover {
  background-color: var(
    --vscode-inputValidation-errorBackground,
    rgba(255, 86, 48, 0.3)
  );
}

/* Expected-only rows (should be removed) */
.expected-only-row {
  background: repeating-linear-gradient(
    45deg,
    var(--vscode-inputValidation-errorBackground, rgba(255, 86, 48, 0.1)),
    var(--vscode-inputValidation-errorBackground, rgba(255, 86, 48, 0.1)) 10px,
    transparent 10px,
    transparent 20px
  ) !important;
  border-left: 3px solid var(--vscode-inputValidation-errorBorder, #ff5630);
}

.expected-only-row:hover {
  background: repeating-linear-gradient(
    45deg,
    var(--vscode-inputValidation-errorBackground, rgba(255, 86, 48, 0.15)),
    var(--vscode-inputValidation-errorBackground, rgba(255, 86, 48, 0.15)) 10px,
    var(--tab-hover-background, rgba(255, 255, 255, 0.1)) 10px,
    var(--tab-hover-background, rgba(255, 255, 255, 0.1)) 20px
  ) !important;
}

.expected-only-row-indicator {
  display: flex;
  flex-direction: column;
  gap: var(--spacing4);
  margin-bottom: var(--spacing8);
  padding: var(--spacing4);
  background-color: var(
    --vscode-inputValidation-errorBackground,
    rgba(255, 86, 48, 0.1)
  );
  border-radius: 4px;
  border-left: 3px solid var(--vscode-inputValidation-errorBorder, #ff5630);
}
